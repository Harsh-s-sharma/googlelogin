<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "YOUR_API_KEY", // Replace with your actual API key
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID",
            measurementId: "YOUR_MEASUREMENT_ID"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        onAuthStateChanged(auth, user => {
            if (user && user.email === 'harsh.sharma.sunil@gmail.com') {
                showAdminPanel(user);
            } else {
                showLogin();
            }
        });

        function showAdminPanel(user) {
            document.getElementById('status').textContent = `Welcome, Admin ${user.displayName}!`;
            document.getElementById('status').style.color = '#4CAF50';
            document.getElementById('adminPanel').style.display = 'block';
            document.getElementById('adminLoginBtn').style.display = 'none';
            displayProducts();
            displayBlogs();
        }

        function showLogin() {
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('adminLoginBtn').style.display = 'block';
            document.getElementById('status').textContent = 'Please log in to access the admin panel.';
            document.getElementById('status').style.color = '#F44336';
        }

        window.handleAdminLogin = async function() {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                document.getElementById('status').textContent = `Error: ${error.message}`;
                document.getElementById('status').style.color = '#F44336';
            }
        }

        window.logout = async function() {
            await signOut(auth);
        }

        // Add Product
        window.addProduct = async function() {
            const name = document.getElementById('productName').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const imageFile = document.getElementById('productImage').files[0];
            const inStock = document.getElementById('inStock').checked;
            const tags = document.getElementById('productTags').value;

            if (!name || isNaN(price) || !imageFile) {
                alert('Please provide valid product details and select an image.');
                return;
            }

            const storageRef = ref(storage, `product_images/${imageFile.name}`);
            try {
                await uploadBytes(storageRef, imageFile);
                const imageUrl = await getDownloadURL(storageRef);
                await addDoc(collection(db, 'products'), { name, price, imageUrl, inStock, tags });
                displayProducts(); // Refresh the product list
            } catch (error) {
                console.error('Error adding product: ', error);
            }
        };

        // Display Products
        async function displayProducts() {
            const productsSnapshot = await getDocs(collection(db, 'products'));
            const productsDisplay = document.getElementById('productsDisplay');
            productsDisplay.innerHTML = '';

            productsSnapshot.forEach(doc => {
                const product = doc.data();
                const productElement = document.createElement('div');
                productElement.innerHTML = `
                    <strong>Name:</strong> ${product.name}, 
                    <strong>Price:</strong> ${product.price}, 
                    <strong>In Stock:</strong> ${product.inStock}, 
                    <strong>Tags:</strong> ${product.tags}
                `;
                const editButton = document.createElement('button');
                editButton.textContent = 'Edit';
                editButton.onclick = () => editProduct(doc.id, product);
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.onclick = () => deleteProduct(doc.id);
                productElement.appendChild(editButton);
                productElement.appendChild(deleteButton);
                productsDisplay.appendChild(productElement);
            });
        }

        // Edit Product
        function editProduct(productId, product) {
            document.getElementById('productName').value = product.name;
            document.getElementById('productPrice').value = product.price;
            document.getElementById('inStock').checked = product.inStock;
            document.getElementById('productTags').value = product.tags;
            document.getElementById('addProductBtn').textContent = 'Update Product';
            document.getElementById('addProductBtn').onclick = () => updateProduct(productId);
        }

        // Update Product
        window.updateProduct = async function(productId) {
            const name = document.getElementById('productName').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const inStock = document.getElementById('inStock').checked;
            const tags = document.getElementById('productTags').value;

            if (!name || isNaN(price)) {
                alert('Please provide valid product details.');
                return;
            }

            await updateDoc(doc(db, 'products', productId), { name, price, inStock, tags });
            document.getElementById('addProductBtn').textContent = 'Add Product';
            document.getElementById('addProductBtn').onclick = addProduct;
            displayProducts(); // Refresh the product list
        };

        // Delete Product
        window.deleteProduct = async function(productId) {
            await deleteDoc(doc(db, 'products', productId));
            displayProducts(); // Refresh the product list
        };

        // Add Blog
        window.addBlog = async function() {
            const title = document.getElementById('blogTitle').value;
            const description = document.getElementById('blogDescription').value;
            const imageFile = document.getElementById('blogImage').files[0];

            if (!title || !description || !imageFile) {
                alert('Please provide valid blog details and select an image.');
                return;
            }

            const storageRef = ref(storage, `blog_images/${imageFile.name}`);
            try {
                await uploadBytes(storageRef, imageFile);
                const imageUrl = await getDownloadURL(storageRef);
                await addDoc(collection(db, 'blogs'), { title, description, imageUrl });
                displayBlogs(); // Refresh the blog list
            } catch (error) {
                console.error('Error adding blog: ', error);
            }
        };

        // Display Blogs
        async function displayBlogs() {
            const blogsSnapshot = await getDocs(collection(db, 'blogs'));
            const blogsDisplay = document.getElementById('blogsDisplay');
            blogsDisplay.innerHTML = '';

            blogsSnapshot.forEach(doc => {
                const blog = doc.data();
                const blogElement = document.createElement('div');
                blogElement.textContent = `Title: ${blog.title}`;
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.onclick = () => deleteBlog(doc.id);
                blogElement.appendChild(deleteButton);
                blogsDisplay.appendChild(blogElement);
            });
        }

        // Delete Blog
        window.deleteBlog = async function(blogId) {
            await deleteDoc(doc(db, 'blogs', blogId));
            displayBlogs(); // Refresh the blog list
        };
    </script>
    <style>
        .container {
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .admin-login-btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .status-message {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .products-display, .blogs-display {
            margin-top: 20px;
        }
        .admin-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .admin-panel h2 {
            margin: 20px 0;
        }
        .admin-panel div {
            margin: 10px 0;
        }
        .admin-panel input, .admin-panel select, .admin-panel textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 5px 0;
        }
        .admin-panel button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .admin-panel button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Admin Panel</h1>
        <button id="adminLoginBtn" onclick="handleAdminLogin()" class="admin-login-btn">Admin Login</button>
        <button id="logoutBtn" onclick="logout()" class="admin-login-btn" style="display: none;">Logout</button>
        <div id="status" class="status-message"></div>

        <div id="adminPanel" class="admin-panel" style="display: none;">
            <h2>Manage Products</h2>
            <div>
                <input type="text" id="productName" placeholder="Product Name" />
                <input type="number" id="productPrice" placeholder="Product Price" />
                <input type="checkbox" id="inStock" /> In Stock
                <select id="productTags">
                    <option value="">Select Tags</option>
                    <option value="Sales">Sales</option>
                    <option value="New">New</option>
                    <option value="Featured">Featured</option>
                </select>
                <input type="file" id="productImage" accept="image/*" />
                <button id="addProductBtn" onclick="addProduct()" class="admin-login-btn">Add Product</button>
            </div>
            <div id="productsDisplay" class="products-display"></div>

            <h2>Manage Blogs</h2>
            <div>
                <input type="text" id="blogTitle" placeholder="Blog Title" />
                <textarea id="blogDescription" placeholder="Blog Description"></textarea>
                <input type="file" id="blogImage" accept="image/*" />
                <button id="addBlogBtn" onclick="addBlog()" class="admin-login-btn">Add Blog</button>
            </div>
            <div id="blogsDisplay" class="blogs-display"></div>
        </div>
    </div>
</body>
</html>
