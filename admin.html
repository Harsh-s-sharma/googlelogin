<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js";

        // Firebase configuration (Replace with your Firebase config)
        const firebaseConfig = {
            apiKey: "AIzaSyCeqnstsolQ7ypJIlGiC0KvEv4pKk4JV7o",
            authDomain: "login-e8086.firebaseapp.com",
            projectId: "login-e8086",
            storageBucket: "login-e8086.appspot.com",
            messagingSenderId: "13482086131",
            appId: "1:13482086131:web:31e8aad8911580e0083186",
            measurementId: "G-8VQ8ME6J88"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // Authentication and User Access Control
        onAuthStateChanged(auth, user => {
            if (user && user.email === 'harsh.sharma.sunil@gmail.com') {
                showAdminPanel(user);
            } else {
                showLogin();
            }
        });

        function showAdminPanel(user) {
            document.getElementById('status').textContent = `Welcome, Admin ${user.displayName}!`;
            document.getElementById('status').style.color = '#4CAF50';
            document.getElementById('adminPanel').style.display = 'block';
            document.getElementById('adminLoginBtn').style.display = 'none';
            // Only show add product details if logged in
            document.getElementById('addProductDetails').style.display = 'block';
            displayProducts();
            displayBlogs();
            // Show logout button
            document.getElementById('logoutBtn').style.display = 'block';
        }

        function showLogin() {
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('adminLoginBtn').style.display = 'block';
            document.getElementById('status').textContent = 'Please log in to access the admin panel.';
            document.getElementById('status').style.color = '#F44336';
            // Hide logout button and add product details
            document.getElementById('logoutBtn').style.display = 'none';
            document.getElementById('addProductDetails').style.display = 'none';
        }

        // Handle Admin Login
        window.handleAdminLogin = async function() {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                document.getElementById('status').textContent = `Error: ${error.message}`;
                document.getElementById('status').style.color = '#F44336';
            }
        }

        window.logout = async function() {
            await signOut(auth);
            window.location.href = 'admin.html'; // Redirect to admin page
        }

        // Add Product
        window.addProduct = async function() {
            const name = document.getElementById('productName').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const imageFile = document.getElementById('productImage').files[0];
            const inStock = document.getElementById('inStock').checked;
            const tags = document.getElementById('productTags').value;

            if (!name || isNaN(price) || !imageFile) {
                alert('Please provide valid product details and select an image.');
                return;
            }

            const storageRef = ref(storage, `product_images/${imageFile.name}`);
            try {
                await uploadBytes(storageRef, imageFile);
                const imageUrl = await getDownloadURL(storageRef);
                await addDoc(collection(db, 'products'), { name, price, imageUrl, inStock, tags });
                displayProducts(); // Refresh the product list
            } catch (error) {
                console.error('Error adding product: ', error);
            }
        };

        // Display Products
        async function displayProducts() {
            const productsSnapshot = await getDocs(collection(db, 'products'));
            const productsDisplay = document.getElementById('productsDisplay');
            productsDisplay.innerHTML = '';

            productsSnapshot.forEach(doc => {
                const product = doc.data();
                const productElement = document.createElement('div');
                productElement.innerHTML = `
                    <strong>Name:</strong> ${product.name}, 
                    <strong>Price:</strong> ${product.price}, 
                    <strong>In Stock:</strong> ${product.inStock}, 
                    <strong>Tags:</strong> ${product.tags}
                `;
                const editButton = document.createElement('button');
                editButton.textContent = 'Edit';
                editButton.onclick = () => editProduct(doc.id, product);
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.onclick = () => deleteProduct(doc.id);
                productElement.appendChild(editButton);
                productElement.appendChild(deleteButton);
                productsDisplay.appendChild(productElement);
            });
        }

        // Rest of the code remains the same...
    </script>
    <style>
        /* Add the styles you provided */
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
    }

    .container {
        max-width: 800px;
        margin: auto;
        padding: 20px;
        background-color: #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    h1 {
        color: #333;
        margin-bottom: 20px;
    }

    .admin-login-btn {
        background-color: #4CAF50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
    }

    .admin-login-btn:hover {
        background-color: #45a049;
    }

    .status-message {
        margin-top: 20px;
        font-weight: bold;
        color: #4CAF50;
    }

    .admin-panel {
        display: none;
    }

    #productsDisplay {
        margin-top: 20px;
    }

    #productsDisplay div {
        margin-bottom: 10px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    #productsDisplay div button {
        background-color: #007bff;
        color: white;
        padding: 5px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.3s;
    }

    #productsDisplay div button:hover {
        background-color: #0056b3;
    }
    </style>
</head>
<body>
    <div class="container">
        <h1>Admin Panel</h1>
        <button id="adminLoginBtn" onclick="handleAdminLogin()" class="admin-login-btn">Admin Login</button>
        <button id="logoutBtn" onclick="logout()" class="admin-login-btn" style="display: none;">Logout</button>
        <div id="status" class="status-message"></div>
        <div id="adminPanel" class="admin-panel" style="display: none;">
            <!-- Admin Panel Content -->
            <div id="addProductDetails" style="display: none;">
                <!-- Add Product Details Form -->
            </div>
        </div>
    </div>
</body>
</html>
